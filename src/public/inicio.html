<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <title>Escolha um GÃªnero</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* (todo o seu CSS permanece igual â€” nÃ£o removi nada) */
    :root {
      --bg: radial-gradient(circle at top, #1b2735 0%, #090a0f 45%, #000 100%);
      --card-bg: rgba(10, 10, 20, 0.9);
      --accent: #ffb342;
      --accent-soft: rgba(255, 179, 66, 0.15);
      --primary-text: #ffffff;
      --secondary-text: #a7b0c0;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --danger: #ff4d4f;
      --success: #3fdca3;
      --shadow-soft: 0 18px 35px rgba(0, 0, 0, 0.8);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, sans-serif;
      color: var(--primary-text);
      background: var(--bg);
      background-attachment: fixed;
    }

    .container {
      width: 100%;
      max-width: 1100px;
      margin: 32px auto 110px;
      padding: 0 16px;
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 24px;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- HEADER -->
    <header class="header">
      <div class="avatar" id="avatar">P</div>
      <div>
        <div class="header-text-top">InÃ­cio</div>
        <div class="header-text-sub" id="subtitle">Carregandoâ€¦</div>
      </div>
    </header>

    <!-- SEARCH -->
    <div class="search-box">
      ğŸ”
      <input id="searchInput" type="text" placeholder="O que vocÃª quer ouvir?" />
    </div>

    <!-- SPOTIFY RESULTS -->
    <section id="spotifyResults" class="results"></section>

    <!-- GRID -->
    <section class="grid">
      <button class="genre-card gospel" onclick="goTo('gospel')">
        <div class="genre-icon">ğŸ“–ğŸµ</div>
        Gospel
      </button>

      <button class="genre-card eletronica" onclick="goTo('eletronica')">
        <div class="genre-icon">ğŸ§</div>
        EletrÃ´nica
      </button>

      <button class="genre-card rock" onclick="goTo('rock')">
        <div class="genre-icon">ğŸ¤˜</div>
        Rock
      </button>

      <button class="genre-card sertanejo" onclick="goTo('sertanejo')">
        <div class="genre-icon">ğŸ¸ğŸ‘’</div>
        Sertanejo
      </button>

      <button class="genre-card funk" onclick="goTo('funk')">
        <div class="genre-icon">ğŸ“¢</div>
        Funk
      </button>

      <button class="genre-card rap" onclick="goTo('rap')">
        <div class="genre-icon">ğŸ¤ğŸ¤</div>
        Rap
      </button>
    </section>
  </div>

  <!-- FOOTER -->
  <footer class="footer-nav">
    <div class="footer-btn active" onclick="window.location.href='/inicio.html'">ğŸ </div>
    <div class="footer-btn" onclick="window.location.href='/chat.html'">ğŸ’¬</div>
    <div class="footer-btn" onclick="window.location.href='/fila.html'">ğŸ“</div>
  </footer>

  <script>
    // Carrega sessÃ£o
    const nome = sessionStorage.getItem("nomeCliente");
    const mesa = sessionStorage.getItem("mesaId");
    const clienteId = sessionStorage.getItem("clienteId");

    if (!nome || !mesa || !clienteId) {
      window.location.href = "/login.html";
    }

    document.getElementById("avatar").textContent = nome[0].toUpperCase();
    document.getElementById("subtitle").textContent =
      `Mesa ${mesa} â€¢ Bem-vindo(a), ${nome}!`;

    function goTo(genero) {
      window.location.href = `/genero-${genero}.html`;
    }

    // ---------- PESQUISA SPOTIFY ----------
    const input = document.getElementById("searchInput");
    const results = document.getElementById("spotifyResults");

    input.addEventListener("keyup", async () => {
      const q = input.value.trim();

      if (q.length < 2) {
        results.innerHTML = "";
        return;
      }

      const res = await fetch(`/api/spotify/search?q=${encodeURIComponent(q)}`);
      const tracks = await res.json();

      results.innerHTML = "";

      tracks.forEach(t => {
        const card = document.createElement("div");
        card.className = "music-card";

        card.innerHTML = `
          <img class="cover" src="${t.album}" />
          <div class="info">
            <div class="title">${t.title}</div>
            <div class="artist">${t.artists}</div>
            <button class="add-btn">Adicionar</button>
          </div>
        `;

        // NOVO BOTÃƒO FUNCIONANDO COM BACKEND
        card.querySelector(".add-btn").onclick = async () => {

          const payload = {
            spotifyUri: t.spotifyUri,
            title: t.title,
            artists: t.artists,
            album: t.album
          };

          const res = await fetch("/pedido-musica/spotify", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "cliente-id": clienteId,
              "mesa-id": mesa
            },
            body: JSON.stringify(payload)
          });

          const json = await res.json();

          if (json.sucesso) {
            alert("ğŸµ MÃºsica adicionada Ã  fila!");
          } else {
            alert("Erro ao adicionar mÃºsica Ã  fila.");
          }
        };

        results.appendChild(card);
      });
    });
  </script>
</body>

</html>
